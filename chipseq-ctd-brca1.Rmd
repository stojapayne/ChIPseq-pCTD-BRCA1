---
title: "U2OS BRCA1 RNAPII ChIP"
author: "Aiola Stoja"
date: '2022-12-29'
output: html_document
---

## ChIP peaks coverage plot 
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(BiocManager)
library(ChIPseeker)
library(TxDb.Hsapiens.UCSC.hg38.knownGene)
txdb <- TxDb.Hsapiens.UCSC.hg38.knownGene
library(clusterProfiler)
#library(remotes) ##used to install seqUtils package to use loadNarrowPeaks (below)
#remotes::install_github("kauralasoo/seqUtils")
library(seqUtils)
library(ggpubr)
library(ggplot2)

peak <- loadNarrowPeaks( "U2OS_narrowpeaks", c("U2OSBRCA1nt_callpeaknoabC","U2OSBRCA1etop_callpeaknoabC",
                                               "U2OSRNAPIIdmso1_callpeaknoabC", "U2OSRNAPIIetop_callpeaknoabC" ),
                peaks_suffix = "_peaks.narrowPeak", 
                sub_dir = FALSE)

covplot <- covplot(peak, weightCol="score", chrs=c("chr17"), xlim=c(4.5e7, 5e7))
covplot + facet_grid(~factor (.id,levels = c( "U2OSRNAPIIdmso1_callpeaknoabC" , "U2OSRNAPIIetop_callpeaknoabC" ,
                                            "U2OSBRCA1nt_callpeaknoabC" , "U2OSBRCA1etop_callpeaknoabC"))) +
  theme(legend.position="none")

```



## Heatmap of ChIP peaks binding to TSS regions
```{r setup, include=FALSE, echo=FALSE}

promoter <- getPromoters(TxDb=txdb, upstream=3000, downstream=3000)

tagMatrix <- lapply(peak, getTagMatrix, windows=promoter)

lapply(names(tagMatrix), function(x) tagHeatmap(tagMatrix[[x]], xlim=c(-3000, 3000), color="red", xlab="Genomic Region (5'-3')", title=names(tagMatrix[x])))

```


## Average profile plot of ChIP peaks binding to TSS region
```{r setup, include=FALSE, echo=FALSE}

plotAvgProf(tagMatrix, xlim=c(-3000, 3000),
            xlab="Genomic Region (5'->3')", ylab = "Read Count Frequency")


lapply(names(tagMatrix), function(x) plotAvgProf(tagMatrix[[x]], xlim=c(-3000, 3000),
                                                 xlab="Genomic Region (5'->3')", ylab =
                                                   "Read Count Frequency",
                                                 conf=0.95, resample=1000))

```